"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[527],{756:(e,t,r)=>{r.r(t),r.d(t,{ActionExecutionMode:()=>Z,ActionResponse:()=>er,ActionValidationResult:()=>et,ApproximateDistinctCountAggregatableProperty:()=>tw,ArrayFilter:()=>tM,ArrayType:()=>eB,AttachmentFilter:()=>tU,AttachmentType:()=>eG,BaseFoundryClient:()=>t5,BooleanFilter:()=>tG,BooleanGroupBy:()=>tT,BooleanType:()=>ek,ByteType:()=>eC,ComputeStep:()=>th,ConfidentialClientAuth:()=>t6,CountOperation:()=>tI,DateType:()=>ew,DecimalType:()=>eP,DefaultAggregatableProperty:()=>tk,Distance:()=>ed,DistanceUnit:()=>ec,DoubleType:()=>ej,FloatType:()=>eD,FoundryApiError:()=>u,GeoPoint:()=>em,GeoPointFilter:()=>tB,GeoPointType:()=>eM,GeoShape:()=>eN,GeoShapeFilter:()=>tJ,GeoShapeType:()=>eU,GeometryCollection:()=>eS,GroupKeyType:()=>tu,IntegerType:()=>eA,LineString:()=>eg,LocalDate:()=>eb,LocalDateFilter:()=>tV,LocalDateGroupBy:()=>tN,LocalDatePropertyMetric:()=>tP,LongType:()=>eR,MetricValueType:()=>tc,MultiGeoPoint:()=>eh,MultiLineString:()=>eI,MultiPolygon:()=>eT,MultipleAggregatableProperty:()=>tC,NumericFilter:()=>tW,NumericGroupBy:()=>tE,NumericPropertyMetric:()=>tD,OAuthToken:()=>re,ObjectType:()=>e_,Op:()=>t$,OrderByOption:()=>tH,Polygon:()=>ef,PublicClientAuth:()=>ry,ReturnEditsMode:()=>ee,SetType:()=>eK,ShortType:()=>eL,StringFilter:()=>tq,StringGroupBy:()=>tb,StringType:()=>eO,StructField:()=>eV,StructType:()=>ex,TimeSeriesType:()=>ev,Timestamp:()=>eE,TimestampFilter:()=>t_,TimestampGroupBy:()=>tO,TimestampPropertyMetric:()=>tv,TimestampType:()=>eF,UserTokenAuth:()=>rg,assertBucketingInternal:()=>to,isCountOperation:()=>tf,isErr:()=>K,isGeoPoint:()=>ep,isOk:()=>B,isOntologyObject:()=>eJ,mapCoordinatesToGeoPoint:()=>ey,visitError:()=>J,visitInternalBucketing:()=>ta});var n=r(1297),o=r(2889),a=r(3534),s=r(8938),i=Object.defineProperty,u=class extends Error{constructor(e,t,r,n){super(),this.errorName=e,this.errorType=t,this.errorInstanceId=n,this.statusCode=r}},c=class extends Error{constructor(e,t,r,n,o,a){super(),this.errorName=t,this.errorType=r,this.statusCode=n,this.errorInstanceId=o,this.message=e,this.parameters=a}},d=class{handlePermissionDenied(e){return{errorName:"PermissionDenied",errorType:"PERMISSION_DENIED",name:e.name,message:e.message,errorInstanceId:e.errorInstanceId,statusCode:e.statusCode}}handleUnauthorized(e){return{name:e.name,message:e.message,errorType:"UNAUTHORIZED",errorName:"Unauthorized",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode}}handleUnknownError(e){return{name:e.name,message:e.message,errorName:"UnknownError",errorType:"UNKNOWN",originalError:"originalError"in e?e.originalError:e}}},l=class extends d{handlePropertiesNotSearchable(e,t){return{name:e.errorName,message:e.message,errorName:"PropertiesNotSearchable",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,propertyApiNames:t}}handlePropertyTypesSearchNotSupported(e,t){return{name:e.errorName,message:e.message,errorName:"PropertyTypesSearchNotSupported",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,parameters:t}}handlePropertiesNotFilterable(e,t){return{name:e.errorName,message:e.message,errorName:"PropertiesNotFilterable",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,properties:t}}handleInvalidAggregationRangeValue(e,t,r,n){return{name:e.errorName,message:e.message,errorName:"InvalidAggregationRangeValue",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,property:t,objectType:r,propertyBaseType:n}}handleOntologySyncing(e,t){return{name:e.errorName,message:e.message,errorName:"OntologySyncing",errorType:"CONFLICT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,objectType:t}}handleInvalidRangeQuery(e,t,r,n,o,a){return{name:e.errorName,message:e.message,errorName:"InvalidRangeQuery",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,field:t,lt:r,gt:n,lte:o,gte:a}}handleInvalidPropertyValue(e,t,r,n){return{name:e.errorName,message:e.message,errorName:"InvalidPropertyValue",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,propertyBaseType:t,property:r,propertyValue:n}}handlePropertiesNotSortable(e,t){return{name:e.errorName,message:e.message,errorName:"PropertiesNotSortable",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,properties:t}}handleInvalidFields(e,t){return{name:e.errorName,message:e.message,errorName:"InvalidFields",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,properties:t}}handleAggregationGroupCountExceededLimit(e,t,r){return{name:e.errorName,message:e.message,errorName:"AggregationGroupCountExceededLimit",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,groupsCount:t,groupsLimit:r}}handleInvalidSortOrder(e,t){return{name:e.errorName,message:e.message,errorName:"InvalidSortOrder",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,invalidSortOrder:t}}handleQueryDepthExceededLimit(e,t,r){return{name:e.errorName,message:e.message,errorName:"QueryDepthExceededLimit",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,depth:t,depthLimit:r}}handleInvalidPropertyFiltersCombination(e,t,r){return{name:e.errorName,message:e.message,errorName:"InvalidPropertyFiltersCombination",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,propertyFilters:t,property:r}}handleDuplicateOrderBy(e,t){return{name:e.errorName,message:e.message,errorName:"DuplicateOrderBy",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,properties:t}}handleInvalidAggregationRange(e){return{name:e.errorName,message:e.message,errorName:"InvalidAggregationRange",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode}}handleInvalidSortType(e,t){return{name:e.errorName,message:e.message,errorName:"InvalidSortType",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,invalidSortType:t}}handlePropertyFiltersNotSupported(e,t,r){return{name:e.errorName,message:e.message,errorName:"PropertyFiltersNotSupported",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,propertyFilters:t,property:r}}handleMultipleGroupByOnFieldNotSupported(e,t){return{name:e.errorName,message:e.message,errorName:"MultipleGroupByOnFieldNotSupported",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,duplicateFields:t}}handleInvalidPropertyFilterValue(e,t,r,n,o){return{name:e.errorName,message:e.message,errorName:"InvalidPropertyFilterValue",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,expectedType:t,propertyFilter:r,propertyFilterValue:n,property:o}}handleInvalidAggregationRangePropertyType(e,t,r,n){return{name:e.errorName,message:e.message,errorName:"InvalidAggregationRangePropertyType",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,property:t,objectType:r,propertyBaseType:n}}},p=class extends d{handleAttachmentSizeExceededLimit(e,t,r){return{name:e.errorName,message:e.message,errorName:"AttachmentSizeExceededLimit",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,fileSizeBytes:t,fileLimitBytes:r}}handleInvalidContentLength(e){return{name:e.errorName,message:e.message,errorName:"InvalidContentLength",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode}}handleInvalidContentType(e){return{name:e.errorName,message:e.message,errorName:"InvalidContentType",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode}}handleAttachmentNotFound(e,t){return{name:e.errorName,message:e.message,errorName:"AttachmentNotFound",errorType:"NOT_FOUND",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,attachmentRid:t}}};function m(e,t,r){switch(t.errorName){case"ObjectTypeNotFound":return e.handleObjectTypeNotFound(t,r.objectType);case"ObjectTypeNotSynced":return e.handleObjectTypeNotSynced(t,r.objectType);case"ObjectsExceededLimit":return e.handleObjectsExceededLimit(t);case"OntologySyncing":return e.handleOntologySyncing(t,r.objectType);case"PermissionDenied":return e.handlePermissionDenied(t);case"Unauthorized":return e.handleUnauthorized(t);case"UnknownError":return e.handleUnknownError(t);default:return t.errorName,e.handleUnknownError(t)}}function y(e,t,r){switch(t.errorName){case"ActionTypeNotFound":return e.handleActionTypeNotFound(t,r.actionType);case"PropertyApiNameNotFound":return e.handlePropertyApiNameNotFound(t,r.propertyId,r.propertyBaseType);case"ActionParameterObjectTypeNotFound":return e.handleActionParameterObjectTypeNotFound(t,r.parameterId);case"InvalidUserId":return e.handleInvalidUserId(t,r.userId);case"FunctionEncounteredUserFacingError":return e.handleFunctionEncounteredUserFacingError(t,r.functionRid,r.functionVersion,r.message);case"FunctionInvalidInput":return e.handleFunctionInvalidInput(t,r.functionRid,r.functionVersion);case"PropertiesNotFound":return e.handlePropertiesNotFound(t,r.objectType,r.properties);case"OntologyEditsExceededLimit":return e.handleOntologyEditsExceededLimit(t,r.editsCount,r.editsLimit);case"ActionNotFound":return e.handleActionNotFound(t,r.actionRid);case"InvalidGroupId":return e.handleInvalidGroupId(t,r.groupId);case"ActionParameterObjectNotFound":return e.handleActionParameterObjectNotFound(t,r.parameterId);case"FunctionExecutionTimedOut":return e.handleFunctionExecutionTimedOut(t,r.functionRid,r.functionVersion);case"PropertyBaseTypeNotSupported":return e.handlePropertyBaseTypeNotSupported(t,r.object,r.property,r.propertyBaseType);case"ApplyActionFailed":return e.handleApplyActionFailed(t);case"ParametersNotFound":return e.handleParametersNotFound(t,r.actionType,r.unknownParameterIds,r.configuredParameterIds);case"ParameterObjectNotFound":return e.handleParameterObjectNotFound(t,r.objectType,r.primaryKey);case"UnknownParameter":return e.handleUnknownParameter(t,r.unknownParameters,r.expectedParameters);case"ActionValidationFailed":return e.handleActionValidationFailed(t,r.actionType);case"ActionEditedPropertiesNotFound":return e.handleActionEditedPropertiesNotFound(t);case"MissingParameter":return e.handleMissingParameter(t,r.parameters);case"PermissionDenied":return e.handlePermissionDenied(t);case"Unauthorized":return e.handleUnauthorized(t);case"UnknownError":return e.handleUnknownError(t);default:return t.errorName,e.handleUnknownError(t)}}function g(e,t,r){switch(t.errorName){case"AttachmentSizeExceededLimit":return e.handleAttachmentSizeExceededLimit(t,r.fileSizeBytes,r.fileLimitBytes);case"InvalidContentLength":return e.handleInvalidContentLength(t);case"InvalidContentType":return e.handleInvalidContentType(t);case"AttachmentNotFound":return e.handleAttachmentNotFound(t,r.attachmentRid);case"PermissionDenied":return e.handlePermissionDenied(t);case"Unauthorized":return e.handleUnauthorized(t);case"UnknownError":return e.handleUnknownError(t);default:return t.errorName,e.handleUnknownError(t)}}function h(e,t,r){switch(t.errorName){case"PermissionDenied":return e.handlePermissionDenied(t);case"Unauthorized":return e.handleUnauthorized(t);case"UnknownError":return e.handleUnknownError(t);default:return t.errorName,e.handleUnknownError(t)}}var I=class extends d{handleActionValidationFailed(e,t){return{name:e.errorName,message:e.message,errorName:"ActionValidationFailed",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,actionType:t}}handleActionTypeNotFound(e,t){return{name:e.errorName,message:e.message,errorName:"ActionTypeNotFound",errorType:"NOT_FOUND",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,actionType:t}}handlePropertyApiNameNotFound(e,t,r){return{name:e.errorName,message:e.message,errorName:"PropertyApiNameNotFound",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,propertyId:t,propertyBaseType:r}}handleActionParameterObjectTypeNotFound(e,t){return{name:e.errorName,message:e.message,errorName:"ActionParameterObjectTypeNotFound",errorType:"NOT_FOUND",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,parameterId:t}}handleInvalidUserId(e,t){return{name:e.errorName,message:e.message,errorName:"InvalidUserId",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,userId:t}}handleFunctionEncounteredUserFacingError(e,t,r,n){return{name:e.errorName,message:n,errorName:"FunctionEncounteredUserFacingError",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,functionRid:t,functionVersion:r}}handleFunctionInvalidInput(e,t,r){return{name:e.errorName,message:e.message,errorName:"FunctionInvalidInput",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,functionRid:t,functionVersion:r}}handlePropertiesNotFound(e,t,r){return{name:e.errorName,message:e.message,errorName:"PropertiesNotFound",errorType:"NOT_FOUND",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,objectType:t,properties:r}}handleOntologyEditsExceededLimit(e,t,r){return{name:e.errorName,message:e.message,errorName:"OntologyEditsExceededLimit",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,editsCount:t,editsLimit:r}}handleActionNotFound(e,t){return{name:e.errorName,message:e.message,errorName:"ActionNotFound",errorType:"NOT_FOUND",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,actionRid:t}}handleInvalidGroupId(e,t){return{name:e.errorName,message:e.message,errorName:"InvalidGroupId",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,groupId:t}}handleActionParameterObjectNotFound(e,t){return{name:e.errorName,message:e.message,errorName:"ActionParameterObjectNotFound",errorType:"NOT_FOUND",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,parameterId:t}}handleFunctionExecutionTimedOut(e,t,r){return{name:e.errorName,message:e.message,errorName:"FunctionExecutionTimedOut",errorType:"TIMEOUT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,functionRid:t,functionVersion:r}}handlePropertyBaseTypeNotSupported(e,t,r,n){return{name:e.errorName,message:e.message,errorName:"PropertyBaseTypeNotSupported",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,objectType:t,property:r,propertyBaseType:n}}handleApplyActionFailed(e){return{name:e.errorName,message:e.message,errorName:"ApplyActionFailed",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode}}handleParametersNotFound(e,t,r,n){return{name:e.errorName,message:e.message,errorName:"ParametersNotFound",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,actionType:t,unknownParameterIds:r,configuredParameterIds:n}}handleParameterObjectNotFound(e,t,r){return{name:e.errorName,message:e.message,errorName:"ParameterObjectNotFound",errorType:"NOT_FOUND",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,objectType:t,primaryKey:r}}handleUnknownParameter(e,t,r){return{name:e.errorName,message:e.message,errorName:"UnknownParameter",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,unknownParameters:t,expectedParameters:r}}handleActionEditedPropertiesNotFound(e){return{name:e.errorName,message:e.message,errorName:"ActionEditedPropertiesNotFound",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode}}handleMissingParameter(e,t){return{name:e.errorName,message:e.message,errorName:"MissingParameter",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,parameters:t}}},f=class extends d{handleParameterObjectSetRidNotFound(e,t){return{name:e.errorName,message:e.message,errorName:"ParameterObjectSetRidNotFound",errorType:"NOT_FOUND",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,objectSetRid:t}}handlePropertyBaseTypeNotSupported(e,t,r,n){return{name:e.errorName,message:e.message,errorName:"PropertyBaseTypeNotSupported",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,objectType:t,property:r,propertyBaseType:n}}handleQueryTimeExceededLimit(e,t,r){return{name:e.errorName,message:e.message,errorName:"QueryTimeExceededLimit",errorType:"TIMEOUT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,functionRid:t,functionVersion:r}}handleInvalidParameterValue(e,t,r,n,o){return{name:e.errorName,message:e.message,errorName:"InvalidParameterValue",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,parameterId:t,parameterBaseType:r,parameterDataType:n,parameterValue:o}}handleQueryNotFound(e,t){return{name:e.errorName,message:e.message,errorName:"QueryNotFound",errorType:"NOT_FOUND",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,query:t}}handleParameterObjectNotFound(e,t,r){return{name:e.errorName,message:e.message,errorName:"ParameterObjectNotFound",errorType:"NOT_FOUND",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,objectType:t,primaryKey:r}}handleQueryMemoryExceededLimit(e,t,r){return{name:e.errorName,message:e.message,errorName:"QueryMemoryExceededLimit",errorType:"TIMEOUT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,functionRid:t,functionVersion:r}}handleQueryEncounteredUserFacingError(e,t,r,n){return{name:e.errorName,errorName:"QueryEncounteredUserFacingError",errorType:"CONFLICT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,functionRid:t,functionVersion:r,message:n}}handleParameterTypeNotSupported(e,t,r){return{name:e.errorName,message:e.message,errorName:"ParameterTypeNotSupported",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,parameterId:t,parameterBaseType:r}}handleMissingParameter(e,t){return{name:e.errorName,message:e.message,errorName:"MissingParameter",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,parameters:t}}},T=class extends d{handleObjectTypeNotFound(e,t){return{name:e.errorName,message:e.message,errorName:"ObjectTypeNotFound",errorType:"NOT_FOUND",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,objectType:t}}handleObjectTypeNotSynced(e,t){return{name:e.errorName,message:e.message,errorName:"ObjectTypeNotSynced",errorType:"CONFLICT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,objectType:t}}handleCompositePrimaryKeyNotSupported(e,t,r){return{name:e.errorName,message:e.message,errorName:"CompositePrimaryKeyNotSupported",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,objectType:t,primaryKey:r}}handlePropertiesNotSortable(e,t){return{name:e.errorName,message:e.message,errorName:"PropertiesNotSortable",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,properties:t}}handleOntologySyncing(e,t){return{name:e.errorName,message:e.message,errorName:"OntologySyncing",errorType:"CONFLICT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,objectType:t}}handleLinkedObjectNotFound(e,t,r,n){return{name:e.errorName,message:e.message,errorName:"LinkedObjectNotFound",errorType:"NOT_FOUND",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,linkType:t,linkedObjectType:r,linkedObjectPrimaryKey:n}}handlePropertiesNotFound(e,t,r){return{name:e.errorName,message:e.message,errorName:"PropertiesNotFound",errorType:"NOT_FOUND",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,objectType:t,properties:r}}handleObjectsExceeded(e){return{name:e.errorName,message:e.message,errorName:"ObjectsExceededLimit",errorType:"INVALID_ARGUMENT"}}},N=class extends d{handleObjectTypeNotFound(e,t){return{name:e.errorName,message:e.message,errorName:"ObjectTypeNotFound",errorType:"NOT_FOUND",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,objectType:t}}handleObjectTypeNotSynced(e,t){return{name:e.errorName,message:e.message,errorName:"ObjectTypeNotSynced",errorType:"CONFLICT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,objectType:t}}handlePropertiesNotSortable(e,t){return{name:e.errorName,message:e.message,errorName:"PropertiesNotSortable",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,properties:t}}handleCompositePrimaryKeyNotSupported(e,t,r){return{name:e.errorName,message:e.message,errorType:"INVALID_ARGUMENT",errorName:"CompositePrimaryKeyNotSupported",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,objectType:t,primaryKey:r}}handleOntologySyncing(e,t){return{name:e.errorName,message:e.message,errorType:"CONFLICT",errorName:"OntologySyncing",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,objectType:t}}handleObjectNotFound(e,t,r){return{name:e.errorName,message:e.message,errorName:"ObjectNotFound",errorType:"NOT_FOUND",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,primaryKey:r,objectType:t}}handlePropertiesNotFound(e,t,r){return{name:e.errorName,message:e.message,errorName:"PropertiesNotFound",errorType:"NOT_FOUND",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,objectType:t,properties:r}}},S=class extends d{handleObjectTypeNotFound(e,t){return{name:e.errorName,message:e.message,errorName:"ObjectTypeNotFound",errorType:"NOT_FOUND",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,objectType:t}}handleObjectTypeNotSynced(e,t){return{name:e.errorName,message:e.message,errorName:"ObjectTypeNotSynced",errorType:"CONFLICT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,objectType:t}}handleObjectsExceededLimit(e){return{name:e.errorName,message:e.message,errorName:"ObjectsExceededLimit",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode}}handleOntologySyncing(e,t){return{name:e.errorName,message:e.message,errorName:"OntologySyncing",errorType:"CONFLICT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,objectType:t}}},E=class extends d{handleObjectTypeNotFound(e,t){return{name:e.errorName,message:e.message,errorName:"ObjectTypeNotFound",errorType:"NOT_FOUND",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,objectType:t}}handleObjectTypeNotSynced(e,t){return{name:e.errorName,message:e.message,errorName:"ObjectTypeNotSynced",errorType:"CONFLICT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,objectType:t}}handleObjectsExceededLimit(e){return{name:e.errorName,message:e.message,errorName:"ObjectsExceededLimit",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode}}handlePropertiesNotFound(e,t,r){return{name:e.errorName,message:e.message,errorName:"PropertiesNotFound",errorType:"NOT_FOUND",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,objectType:t,properties:r}}handlePropertiesNotSearchable(e,t){return{name:e.errorName,message:e.message,errorName:"PropertiesNotSearchable",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,propertyApiNames:t}}handlePropertyTypesSearchNotSupported(e,t){return{name:e.errorName,message:e.message,errorName:"PropertyTypesSearchNotSupported",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,parameters:t}}handlePropertiesNotFilterable(e,t){return{name:e.errorName,message:e.message,errorName:"PropertiesNotFilterable",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,properties:t}}handleMalformedPropertyFilters(e,t){return{name:e.errorName,message:e.message,errorName:"MalformedPropertyFilters",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,malformedPropertyFilter:t}}handleOntologySyncing(e,t){return{name:e.errorName,message:e.message,errorName:"OntologySyncing",errorType:"CONFLICT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,objectType:t}}handleInvalidRangeQuery(e,t,r,n,o,a){return{name:e.errorName,message:e.message,errorName:"InvalidRangeQuery",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,field:t,lt:r,gt:n,lte:o,gte:a}}handleInvalidPropertyValue(e,t,r,n){return{name:e.errorName,message:e.message,errorName:"InvalidPropertyValue",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,propertyBaseType:t,property:r,propertyValue:n}}handlePropertiesNotSortable(e,t){return{name:e.errorName,message:e.message,errorName:"PropertiesNotSortable",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,properties:t}}handleInvalidSortOrder(e,t){return{name:e.errorName,message:e.message,errorName:"InvalidSortOrder",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,invalidSortOrder:t}}handleQueryDepthExceededLimit(e,t,r){return{name:e.errorName,message:e.message,errorName:"QueryDepthExceededLimit",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,depth:t,depthLimit:r}}handleInvalidPropertyFiltersCombination(e,t,r){return{name:e.errorName,message:e.message,errorName:"InvalidPropertyFiltersCombination",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,propertyFilters:t,property:r}}handleDuplicateOrderBy(e,t){return{name:e.errorName,message:e.message,errorName:"DuplicateOrderBy",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,properties:t}}handleInvalidSortType(e,t){return{name:e.errorName,message:e.message,errorName:"InvalidSortType",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,invalidSortType:t}}handlePropertyFiltersNotSupported(e,t,r){return{name:e.errorName,message:e.message,errorName:"PropertyFiltersNotSupported",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,propertyFilters:t,property:r}}handleInvalidPropertyFilterValue(e,t,r,n,o){return{name:e.errorName,message:e.message,errorName:"InvalidPropertyFilterValue",errorType:"INVALID_ARGUMENT",errorInstanceId:e.errorInstanceId,statusCode:e.statusCode,expectedType:t,property:o,propertyFilter:r,propertyFilterValue:n}}},b=class extends d{};function O(e){let t=new Map;return(r,n)=>{let o=r.objects[n],a=t.get(o);return null==a&&(a=e(r,n),t.set(o,a)),a}}var A=new Set(["break","case","catch","class","const","continue","debugger","default","delete","do","else","enum","export","extends","false","finally","for","function","if","import","in","instanceof","new","null","return","super","switch","this","throw","true","try","typeof","var","void","while","with","implements","interface","let","package","private","protected","public","static","yield"]);function w(e){return A.has(e)}function k(e){return{type:"ok",value:e}}function C(e){return{type:"error",error:e}}async function P(e,t){try{let t=await e();return k(t)}catch(e){if(e.errorName&&e.errorInstanceId)return C(t(e));return C(e)}}function D(e,t,r,n,o){return P(async()=>v(e,t,r,n,o),e=>(function(e,t,r){switch(t.errorName){case"ObjectTypeNotFound":return e.handleObjectTypeNotFound(t,r.objectType);case"ObjectTypeNotSynced":return e.handleObjectTypeNotSynced(t,r.objectType);case"PropertiesNotSortable":return e.handlePropertiesNotSortable(t,r.properties);case"CompositePrimaryKeyNotSupported":return e.handleCompositePrimaryKeyNotSupported(t,r.objectType,r.primaryKey);case"OntologySyncing":return e.handleOntologySyncing(t,r.objectType);case"LinkedObjectNotFound":return e.handleLinkedObjectNotFound(t,r.linkType,r.linkedObjectType,r.linkedObjectPrimaryKey);case"PropertiesNotFound":return e.handlePropertiesNotFound(t,r.objectType,r.properties);case"ObjectsExceeded":return e.handleObjectsExceeded(t);case"PermissionDenied":return e.handlePermissionDenied(t);case"Unauthorized":return e.handleUnauthorized(t);case"UnknownError":return e.handleUnknownError(t);default:return t.errorName,e.handleUnknownError(t)}})(new T,e,e.parameters))}async function v(e,t,r,a,s){let i=await (0,n.xK)((0,o.Sy)(e.stack,e.fetch),e.ontology.metadata.ontologyApiName,t,encodeURIComponent(r),a,s,{select:[]});return Y(e,i)}async function F(e,t,r,a,s){let i=await (0,n.i4)((0,o.Sy)(e.stack,e.fetch),e.ontology.metadata.ontologyApiName,t,encodeURIComponent(r),a,{pageSize:s?.pageSize,pageToken:s?.pageToken,select:[]});return{data:i.data.map(t=>Y(e,t)),nextPageToken:i.nextPageToken}}function L(e,t,r,n){return P(async()=>R(e,t,r,n),e=>m(new S,e,e.parameters))}async function R(e,t,r,n){let o;let a=[];do for(let s of(o=await F(e,t,r,n,{pageToken:o?.nextPageToken})).data)a.push(s);while(o.nextPageToken);return a}async function*j(e,t,r,n){let o;do for(let a of(await F(e,t,r,n,{pageToken:o})).data)yield a;while(null!=o)}async function*M(e,t){try{for await(let t of e())yield k(t)}catch(e){e instanceof c?yield C(t(e)):yield C(e)}}async function U(e,t,r){let n=P(e,r),o=M(t,r);return Object.assign(n,{[Symbol.asyncIterator]:()=>o})}async function G(e,t){return Object.assign(await e(),{[Symbol.asyncIterator]:t})}async function*_(e,t,r,a,s){let i;do{let u=await (0,n.i4)((0,o.Sy)(e.stack,e.fetch),e.ontology.metadata.ontologyApiName,t,encodeURIComponent(r),a,{pageSize:s?.pageSize,pageToken:i,select:[]});for(let t of u.data)yield Y(e,t);i=u.nextPageToken}while(i)}async function V(e,t,r,n,o){return U(async()=>F(e,t,r,n,o),()=>_(e,t,r,n,o),e=>m(new S,e,e.parameters))}async function x(e,t,r,n,o){return G(async()=>F(e,t,r,n,o),()=>_(e,t,r,n,o))}function B(e){return"ok"===e.type}function K(e){return"error"===e.type}function J(e,t){return(t[e.name]||t.default)(e)}async function W(e,t,r,n){let o=await L(e,t,r,n);return K(o)?o:"ok"===o.type&&o.value.length>1?C({name:"Too many objects",message:`There are multiple ${n} objects for this object, but there should only be one`,errorName:"LinkedObjectNotFound",errorType:"NOT_FOUND",linkType:n,linkedObjectType:t,linkedObjectPrimaryKey:{primaryKey:r.toString()}}):"ok"===o.type&&1!==o.value.length?C({name:"Object not found",message:"Expected to receive a single object but received none",errorType:"NOT_FOUND",errorName:"LinkedObjectNotFound",linkType:n,linkedObjectType:t,linkedObjectPrimaryKey:{primaryKey:r.toString()}}):{type:"ok",value:o.value[0]}}async function $(e,t,r,n){let a=await R(e,t,r,n);if(1!==a.length)throw new o.mZ(`Expected a single result but got ${a.length} instead`);return a[0]}var z=Symbol(),Q=O(function(e,t){let r=e.objects[t],n={};for(let e of(Object.defineProperty(n,"__apiName",{get:()=>t}),Object.defineProperty(n,"$apiName",{get:()=>t}),Object.defineProperty(n,"$primaryKey",{get:function(){return this.__primaryKey}}),Object.defineProperty(n,"$rid",{get:function(){return this.__rid}}),n.toString=function(){let e={};for(let t of Object.keys(r.properties))e[w(t)?`${t}_`:t]=this[t];return e.__primaryKey=this.__primaryKey,e.__apiName=t,e.__rid=this.__rid,e.$primaryKey=this.__primaryKey,e.$apiName=t,e.$rid=this.__rid,JSON.stringify(e,void 0,2)},Object.keys(r.properties)))w(e)&&Object.defineProperty(n,`${e}_`,{get:function(){return this[e]}});for(let[e,{multiplicity:t}]of Object.entries(r.links))Object.defineProperty(n,e,{get:function(){let n=this[z];return!0===t?function(e,t,r,n){return{get:o=>D(e,t,r,n,o.toString()),fetchOneWithErrors:o=>D(e,t,r,n,o.toString()),fetchOne:o=>v(e,t,r,n,o.toString()),all:()=>L(e,t,r,n),page:o=>V(e,t,r,n,o),fetchPage:o=>x(e,t,r,n,o),fetchPageWithErrors:o=>V(e,t,r,n,o),asyncIter:()=>j(e,t,r,n)}}(n,r.apiName,this.__primaryKey,e):function(e,t,r,n){return{get:async()=>W(e,t,r,n),fetchOneWithErrors:async()=>W(e,t,r,n),fetchOne:async()=>$(e,t,r,n)}}(n,r.apiName,this.__primaryKey,e)}});return n});function Y(e,t){let r=t.__apiName;return Object.setPrototypeOf(t,Q(e.ontology,r)),Object.defineProperty(t,z,{enumerable:!1,writable:!1,value:e}),function(e,t,r){for(let[n,o]of Object.entries(e.ontology.objects[t].properties))if(null!=r[n])switch(o.type){case"attachment":H(r,n,t=>ei(e,t.rid));break;case"geopoint":H(r,n,e=>em.fromGeoJson(e));break;case"geoshape":H(r,n,e=>eN.fromGeoJson(e));break;case"datetime":H(r,n,e=>eb.fromISOString(e));break;case"timestamp":H(r,n,e=>eE.fromISOString(e));break;case"numericTimeseries":case"stringTimeseries":H(r,n,o=>e3(e,n,t,r.__primaryKey));case"string":case"boolean":case"double":case"integer":case"short":case"long":case"float":case"decimal":case"byte":case"marking":break;default:o.type}}(e,r,t),t}function H(e,t,r){null!=e[t]&&(Array.isArray(e[t])?function(e,t,r){let n=e[t],o=n.slice();for(let e=0;e<o.length;e++)Object.defineProperty(o,e,{get:function(e){let t;return function(){return t||(t=r(n[e])),t}}(e)});e[t]=o}(e,t,r):function(e,t,r){let n;let o=e[t];Object.defineProperty(e,t,{get:function(){return n||(n=r(o)),n}})}(e,t,r))}async function q(e,t,r,n=[]){return P(async()=>X(e,t,r,n),e=>(function(e,t,r){switch(t.errorName){case"ObjectTypeNotFound":return e.handleObjectTypeNotFound(t,r.objectType);case"ObjectTypeNotSynced":return e.handleObjectTypeNotSynced(t,r.objectType);case"PropertiesNotSortable":return e.handlePropertiesNotSortable(t,r.properties);case"CompositePrimaryKeyNotSupported":return e.handleCompositePrimaryKeyNotSupported(t,r.objectType,r.primaryKey);case"OntologySyncing":return e.handleOntologySyncing(t,r.objectType);case"ObjectNotFound":return e.handleObjectNotFound(t,r.objectType,r.primaryKey);case"PropertiesNotFound":return e.handlePropertiesNotFound(t,r.objectType,r.properties);case"PermissionDenied":return e.handlePermissionDenied(t);case"Unauthorized":return e.handleUnauthorized(t);case"UnknownError":return e.handleUnknownError(t);default:return t.errorName,e.handleUnknownError(t)}})(new N,e,e.parameters))}async function X(e,t,r,a=[]){let s=await (0,n.kh)((0,o.Sy)(e.stack,e.fetch),e.ontology.metadata.ontologyApiName,t,encodeURIComponent(r.toString()),{select:a.map(e=>e.toString())});return Y(e,s)}var Z=function(e){return e[e.VALIDATE_ONLY=0]="VALIDATE_ONLY",e[e.VALIDATE_AND_EXECUTE=1]="VALIDATE_AND_EXECUTE",e}({}),ee=function(e){return e[e.ALL=0]="ALL",e[e.NONE=1]="NONE",e}({}),et=function(e){return e[e.VALID=0]="VALID",e[e.INVALID=1]="INVALID",e[e.UNKNOWN=2]="UNKNOWN",e}({}),er={of:(e,t)=>{let r={result:et[t.validation?.result]};return t.edits?.type==="edits"?{validation:r,...eo(t.edits,e)}:t.edits?.type==="largeScaleEdits"?{validation:r,edits:{type:"bulkEdits"}}:{validation:r}}},en={of:(e,t)=>t.edits?.type==="edits"?eo(t.edits,e):t.edits?.type==="largeScaleEdits"?{edits:{type:"bulkEdits"}}:{}};function eo(e,t){let r=[],n=[];for(let o of e.edits)"addObject"===o.type&&r.push({apiName:o.objectType,primaryKey:o.primaryKey,get:()=>q(t,o.objectType,o.primaryKey),fetchOneWithErrors:()=>q(t,o.objectType,o.primaryKey),fetchOne:()=>X(t,o.objectType,o.primaryKey)}),"modifyObject"===o.type&&n.push({apiName:o.objectType,primaryKey:o.primaryKey,get:()=>q(t,o.objectType,o.primaryKey),fetchOneWithErrors:()=>q(t,o.objectType,o.primaryKey),fetchOne:()=>X(t,o.objectType,o.primaryKey)});return{edits:{type:"edits",added:r,modified:n}}}async function ea(e,t){return P(async()=>await (0,n.xN)((0,o.Sy)(e.stack,e.fetch),t),e=>g(new p,e,e.parameters))}async function es(e,t){return P(async()=>await (0,n.if)((0,o.Sy)(e.stack,e.fetch),t),e=>g(new p,e,e.parameters))}var ei=(e,t)=>({attachmentRid:t,type:"Attachment",getMetadata:()=>es(e,t),read:()=>ea(e,t)}),eu=e=>({upload:(t,r)=>(function(e,t,r){return P(async()=>{let a=await (0,n.vX)((0,o.Sy)(e.stack,e.fetch,void 0),r,{filename:t},{"Content-Length":r.size,"Content-Type":r.type});return ei(e,a.rid)},e=>g(new p,e,e.parameters))})(e,t,r)}),ec=function(e){return e.MILLIMETERS="MILLIMETERS",e.CENTIMETERS="CENTIMETERS",e.METERS="METERS",e.KILOMETERS="KILOMETERS",e.INCHES="INCHES",e.FEET="FEET",e.YARDS="YARDS",e.MILES="MILES",e.NAUTICAL_MILES="NAUTICAL_MILES",e}({}),ed={ofMillimeters:e=>({unit:ec.MILLIMETERS,value:e}),ofCentimeters:e=>({unit:ec.CENTIMETERS,value:e}),ofMeters:e=>({unit:ec.METERS,value:e}),ofKilometers:e=>({unit:ec.KILOMETERS,value:e}),ofInches:e=>({unit:ec.INCHES,value:e}),ofFeet:e=>({unit:ec.FEET,value:e}),ofYards:e=>({unit:ec.YARDS,value:e}),ofMiles:e=>({unit:ec.MILES,value:e}),ofNauticalMiles:e=>({unit:ec.NAUTICAL_MILES,value:e})},el=function(e){return e[e.ONE_DIGIT=1]="ONE_DIGIT",e[e.TWO_DIGITS=2]="TWO_DIGITS",e[e.THREE_DIGITS=3]="THREE_DIGITS",e[e.FOUR_DIGITS=4]="FOUR_DIGITS",e[e.FIVE_DIGITS=5]="FIVE_DIGITS",e[e.SIX_DIGITS=6]="SIX_DIGITS",e[e.SEVEN_DIGITS=7]="SEVEN_DIGITS",e[e.EIGHT_DIGITS=8]="EIGHT_DIGITS",e[e.NINE_DIGITS=9]="NINE_DIGITS",e[e.TEN_DIGITS=10]="TEN_DIGITS",e[e.ELEVEN_DIGITS=11]="ELEVEN_DIGITS",e[e.TWELVE_DIGITS=12]="TWELVE_DIGITS",e}(el||{});function ep(e){return e?.type==="GeoPoint"}var em=class e{type="GeoPoint";static geoHashRegex=/^([0123456789bcdefghjkmnpqrstuvwxyz])+$/i;#e;#t;constructor(e,t){this.#e=e,this.#t=t}toCoordinates(){return this.#e}toGeoHash(){return a.encode(this.#e.latitude,this.#e.longitude,this.#t??el.TWELVE_DIGITS)}toGeoJson(){return{type:"Point",coordinates:[this.#e.longitude,this.#e.latitude]}}static fromGeoHash(t){if(t.includes(","))return this.fromCoordinatesString(t);this.geoHashRegex.test(t)||this.throwInvalidGeoHashError(t);let{latitude:r,longitude:n}=a.decode(t);return new e({latitude:r,longitude:n},t.length)}static fromCoordinates(t){return new e(t)}static fromGeoJson(t){return e.fromCoordinates({longitude:t.coordinates[0],latitude:t.coordinates[1]})}static fromCoordinatesString(t){let r=t.split(",").map(e=>e.trim());2===r.length&&r.every(e=>e.length>0)||this.throwInvalidGeoHashError(t);let[n,o]=r.map(Number);return Number.isFinite(n)&&Number.isFinite(o)||this.throwInvalidGeoHashError(t),new e({latitude:n,longitude:o})}static throwInvalidGeoHashError(e){throw Error(`Received invalid geohash ${e}. An acceptable value should either be a geohash string or a "lat, long" string`)}};function ey(e){return em.fromCoordinates({longitude:e[0],latitude:e[1]})}var eg=class e{type="LineString";constructor(e){this.geoPoints=e}getGeoPoints(){return this.geoPoints}toGeoJson(){return{type:"LineString",coordinates:this.geoPoints.map(e=>e.toGeoJson().coordinates)}}static fromGeoPoints(t){if(t.length<2)throw Error("LineString's must be represented by two or more GeoPoints");return new e(t)}static fromGeoJson(t){let r=t.coordinates.map(ey);return e.fromGeoPoints(r)}},eh=class e{type="MultiGeoPoint";constructor(e){this.geoPoints=e}getGeoPoints(){return this.geoPoints}toGeoJson(){return{type:"MultiPoint",coordinates:this.geoPoints.map(e=>e.toGeoJson().coordinates)}}static fromGeoPoints(t){return new e(t)}static fromGeoJson(t){let r=t.coordinates.map(ey);return e.fromGeoPoints(r)}},eI=class e{type="MultiLineString";constructor(e){this.geoLineStrings=e}getLineStrings(){return this.geoLineStrings}toGeoJson(){return{type:"MultiLineString",coordinates:this.geoLineStrings.map(e=>e.toGeoJson().coordinates)}}static fromLineStrings(t){return new e(t)}static fromGeoJson(t){let r=t.coordinates.map(e=>eg.fromGeoPoints(e.map(ey)));return e.fromLineStrings(r)}},ef=class e{type="Polygon";constructor(e){this.linearRings=e}getLinearRings(){return this.linearRings}toGeoJson(){return{type:"Polygon",coordinates:this.linearRings.map(e=>e.map(e=>e.toGeoJson().coordinates))}}static fromLinearRings(t){if(t.length<1)throw Error("Polygons must be represented by at least one outer linear-ring");return t.forEach(e=>{if(e.length<4)throw Error(`Polygons must be represented by at least four coordinates, received ${e.length}`);if(e[0]?.toCoordinates().latitude!==e[e.length-1]?.toCoordinates().latitude||e[0]?.toCoordinates().longitude!==e[e.length-1]?.toCoordinates().longitude)throw Error(`The first and last GeoPoint in the array must represent the same exact position,received first: ${JSON.stringify(e[0]?.toCoordinates())} last: ${JSON.stringify(e[e.length-1]?.toCoordinates())}`)}),new e(t)}static fromGeoJson(t){let r=t.coordinates.map(e=>e.map(ey));return e.fromLinearRings(r)}},eT=class e{type="MultiPolygon";constructor(e){this.polygons=e}getPolygons(){return this.polygons}toGeoJson(){return{type:"MultiPolygon",coordinates:this.polygons.map(e=>e.toGeoJson().coordinates)}}static fromPolygons(t){return new e(t)}static fromGeoJson(t){let r=t.coordinates.map(e=>ef.fromLinearRings(e.map(e=>e.map(ey))));return e.fromPolygons(r)}},eN={isGeoPoint:e=>e?.type==="GeoPoint",isPolygon:e=>e?.type==="Polygon",isLineString:e=>e?.type==="LineString",isMultiGeoPoint:e=>e?.type==="MultiGeoPoint",isMultiPolygon:e=>e?.type==="MultiPolygon",isMultiLineString:e=>e?.type==="MultiLineString",isGeometryCollection:e=>e?.type==="GeometryCollection",isGeoShape:e=>e?.type==="geoshape"||eN.isGeoPoint(e)||eN.isPolygon(e)||eN.isLineString(e)||eN.isMultiGeoPoint(e)||eN.isMultiPolygon(e)||eN.isMultiLineString(e)||eN.isGeometryCollection(e),fromGeoJson(e){switch(e.type){case"Point":return em.fromGeoJson(e);case"Polygon":return ef.fromGeoJson(e);case"LineString":return eg.fromGeoJson(e);case"MultiPoint":return eh.fromGeoJson(e);case"MultiPolygon":return eT.fromGeoJson(e);case"MultiLineString":return eI.fromGeoJson(e);case"GeometryCollection":return eS.fromGeoJson(e)}}},eS=class e{type="GeometryCollection";constructor(e){this.geometries=e}toGeoJson(){return{type:"GeometryCollection",geometries:this.geometries.map(e=>e.toGeoJson())}}getGeometries(){return this.geometries}static fromGeometries(t){return new e(t)}static fromGeoJson(t){return t.geometries.map(eN.fromGeoJson).forEach(e=>{if(eN.isGeometryCollection(e))throw Error("Cannot have nested geometry collections.")}),e.fromGeometries(t.geometries.map(eN.fromGeoJson))}},eE=class e{type="Timestamp";static now(){return new e(s.c9.utc())}static fromISOString(t){return new e(s.c9.fromISO(t,{zone:"utc",setZone:!0}))}static fromEpochMilli(t){return new e(s.c9.fromMillis(t,{zone:"utc"}))}static fromJsDate(t){return new e(s.c9.fromJSDate(t,{zone:"utc"}))}constructor(e){this.dateTime=e}getYear(){return this.dateTime.year}getMonth(){return this.dateTime.month}getDayOfMonth(){return this.dateTime.day}getHours(){return this.dateTime.hour}getMinutes(){return this.dateTime.minute}getSeconds(){return this.dateTime.second}getMilliseconds(){return this.dateTime.millisecond}getTimezoneOffset(){return this.dateTime.offset}getTime(){return this.dateTime.valueOf()}valueOf(){return this.getTime()}isEqual(e){return this.getTime()===e.getTime()}toJsDate(){return this.dateTime.toJSDate()}toLocalDate(){return eb.of(this.getYear(),this.getMonth(),this.getDayOfMonth())}toISOString(){return this.dateTime.toISO()}minusMilliseconds(t){return new e(this.dateTime.minus(t))}minusSeconds(t){let r=s.dw.fromObject({seconds:t});return new e(this.dateTime.minus(r))}minusMinutes(t){let r=s.dw.fromObject({minutes:t});return new e(this.dateTime.minus(r))}minusHours(t){let r=s.dw.fromObject({hours:t});return new e(this.dateTime.minus(r))}minusDays(t){let r=s.dw.fromObject({days:t});return new e(this.dateTime.minus(r))}minusWeeks(t){let r=s.dw.fromObject({weeks:t});return new e(this.dateTime.minus(r))}minusMonths(t){let r=s.dw.fromObject({months:t});return new e(this.dateTime.minus(r))}minusYears(t){let r=s.dw.fromObject({years:t});return new e(this.dateTime.minus(r))}plusMilliseconds(t){let r=s.dw.fromObject({milliseconds:t});return new e(this.dateTime.plus(r))}plusSeconds(t){let r=s.dw.fromObject({seconds:t});return new e(this.dateTime.plus(r))}plusMinutes(t){let r=s.dw.fromObject({minutes:t});return new e(this.dateTime.plus(r))}plusHours(t){let r=s.dw.fromObject({hours:t});return new e(this.dateTime.plus(r))}plusDays(t){let r=s.dw.fromObject({days:t});return new e(this.dateTime.plus(r))}plusWeeks(t){let r=s.dw.fromObject({weeks:t});return new e(this.dateTime.plus(r))}plusMonths(t){let r=s.dw.fromObject({months:t});return new e(this.dateTime.plus(r))}plusYears(t){let r=s.dw.fromObject({years:t});return new e(this.dateTime.plus(r))}},eb=class e{type="LocalDate";static now(){return e.fromDateTime(s.c9.utc())}static fromISOString(t){if(!t.match(/^\d{4}-\d{2}-\d{2}$/))throw Error(`${t} doesn't match expected YYYY-MM-DD format`);return e.fromDateTime(s.c9.fromISO(t,{zone:"utc"}))}static of(t,r,n){return new e(t,r,n)}static fromDateTime(t){return e.of(t.year,t.month,t.day)}constructor(e,t,r){this.dateTime=s.c9.utc(e,t,r)}getYear(){return this.dateTime.year}getMonth(){return this.dateTime.month}getDayOfMonth(){return this.dateTime.day}toISOString(){return this.dateTime.toISODate()}getISOWeekday(){return this.dateTime.weekday}toJsDate(e){return this.toTimestamp(e).toJsDate()}toTimestamp(e){let t=s.mQ.parseSpecifier("UTC"+e),r=this.dateTime.setZone(t,{keepLocalTime:!0});return eE.fromISOString(r.toISO())}valueOf(){return this.toTimestamp().valueOf()}isEqual(e){return this.toISOString()===e.toISOString()}minusDays(t){return e.fromDateTime(this.dateTime.minus(s.dw.fromObject({days:t})))}minusWeeks(t){return e.fromDateTime(this.dateTime.minus(s.dw.fromObject({weeks:t})))}minusMonths(t){return e.fromDateTime(this.dateTime.minus(s.dw.fromObject({months:t})))}minusYears(t){return e.fromDateTime(this.dateTime.minus(s.dw.fromObject({years:t})))}plusDays(t){return e.fromDateTime(this.dateTime.plus(s.dw.fromObject({days:t})))}plusWeeks(t){return e.fromDateTime(this.dateTime.plus(s.dw.fromObject({weeks:t})))}plusMonths(t){return e.fromDateTime(this.dateTime.plus(s.dw.fromObject({months:t})))}plusYears(t){return e.fromDateTime(this.dateTime.plus(s.dw.fromObject({years:t})))}},eO={of:()=>({type:"string"})},eA={of:()=>({type:"integer"})},ew={of:()=>({type:"date"})},ek={of:()=>({type:"boolean"})},eC={of:()=>({type:"byte"})},eP={of:()=>({type:"decimal"})},eD={of:()=>({type:"float"})},ev={of:e=>({type:"timeSeries",subType:e})},eF={of:()=>({type:"timestamp"})},eL={of:()=>({type:"short"})},eR={of:()=>({type:"long"})},ej={of:()=>({type:"double"})},eM={of:()=>({type:"GeoPoint"})},eU={of:()=>({type:"GeoShape"})},eG={of:()=>({type:"attachment"})},e_={of:e=>({type:"object",objectTypeApiName:e})},eV={of:(e,t,r)=>({name:e,fieldType:t,required:r})},ex={of:e=>({type:"struct",fields:e})},eB={of:e=>({type:"array",subType:e})},eK={of:e=>({type:"set",subType:e})};function eJ(e){return e&&"object"==typeof e&&("string"==typeof e.__apiName&&"__primaryKey"in e||"string"==typeof e.$apiName&&"$primaryKey"in e)}var eW=function(e){return e.BEFORE="BEFORE",e.AFTER="AFTER",e}({}),e$=function(e){return e.YEARS="YEARS",e.MONTHS="MONTHS",e.WEEKS="WEEKS",e.DAYS="DAYS",e.HOURS="HOURS",e.MINUTES="MINUTES",e.SECONDS="SECONDS",e.MILLISECONDS="MILLISECONDS",e}({});async function ez(e,t,r,a){return P(async()=>{let s=await (0,n.tT)((0,o.Sy)(e.stack,e.fetch),e.ontology.metadata.ontologyApiName,t,encodeURIComponent(r),a);return{time:eE.fromISOString(s.time),value:s.value}},e=>h(new b,e,e.parameters))}async function eQ(e,t,r,a){return P(async()=>{let s=await (0,n.vS)((0,o.Sy)(e.stack,e.fetch),e.ontology.metadata.ontologyApiName,t,encodeURIComponent(r),a);return{time:eE.fromISOString(s.time),value:s.value}},e=>h(new b,e,e.parameters))}var eY=new Uint8Array([123,34,100,97,116,97,34,58,91]);async function*eH(e){let t=new TextDecoder("utf-8"),r=!1,n=[],o=0;for await(let a of e){let e=0;for(!r&&(r=!0,function(e,t){if(e.length<t.length)return!1;for(let r=0;r<t.length;r++)if(e[r]!==t[r])return!1;return!0}(a,eY)&&(e=eY.length));e<a.length;e++){for(;0===o&&123!==a[e]&&e<a.length;)e++;let r=e;for(;r<a.length;r++){let s=a[r];if(123===s)o++;else if(125===s&&0==--o){yield function(e,t,r){let n="";for(let r of t)n+=e.decode(r,{stream:!0});return JSON.parse(n+=e.decode(r))}(t,n,a.subarray(e,r+1)),n=[],e=r;break}}if(r===a.length){n.push(a.subarray(e));break}}}}async function*eq(e){let t=await e.read();for(;!t.done;)yield t.value,t=await e.read()}async function eX(e,t,r,a,s){return P(async()=>{let i=await (0,n.u1)((0,o.Sy)(e.stack,e.fetch,void 0,!0),e.ontology.metadata.ontologyApiName,t,encodeURIComponent(r),a,s),u=[];for await(let e of eH(eq(i.getReader())))u.push({time:eE.fromISOString(e.time),value:e.value});return u},e=>h(new b,e,e.parameters))}async function*eZ(e,t,r,a,s){yield*M(async function*(){let i=eq((await (0,n.u1)((0,o.Sy)(e.stack,e.fetch,void 0,!0),e.ontology.metadata.ontologyApiName,t,encodeURIComponent(r),a,s)).getReader()),u=await i.next(),c=new Promise((e,t)=>{e(e0(i))});for(let e of(yield{time:eE.fromISOString(u.value.time),value:u.value.value},await c))yield{time:eE.fromISOString(e.time),value:e.value}},e=>h(new b,e,e.parameters))}async function e0(e){let t=[];for await(let r of e)for(let e of r)t.push(e);return t}function e1(e,t,r,n,o={}){return{all:()=>eX(e,r,n,t,o),iterate:()=>eZ(e,r,n,t,o)}}var e2=(e,t,r,n)=>{let o=e1(e,t,r,n),a=o=>e1(e,t,r,n,{range:{type:"relative",startTime:o}});return{...o,fromYearsAgo:e=>a({when:eW.BEFORE,unit:e$.YEARS,value:e}),fromMonthsAgo:e=>a({when:eW.BEFORE,unit:e$.MONTHS,value:e}),fromWeeksAgo:e=>a({when:eW.BEFORE,unit:e$.WEEKS,value:e}),fromDaysAgo:e=>a({when:eW.BEFORE,unit:e$.DAYS,value:e}),fromHoursAgo:e=>a({when:eW.BEFORE,unit:e$.HOURS,value:e}),fromMinutesAgo:e=>a({when:eW.BEFORE,unit:e$.MINUTES,value:e}),fromSecondsAgo:e=>a({when:eW.BEFORE,unit:e$.SECONDS,value:e}),fromMillisecondsAgo:e=>a({when:eW.BEFORE,unit:e$.MILLISECONDS,value:e}),range(o){let a={};if(0!==Object.keys(o).length){let e={type:"absolute"};o.startTime&&(e.startTime=o?.startTime?.toISOString()),o.endTime&&(e.endTime=o?.endTime?.toISOString()),a={range:e}}else throw Error("Argument .range() needs at least one input.");return e1(e,t,r,n,a)}}},e3=(e,t,r,n)=>({type:"TimeSeries",getFirstPoint:()=>ez(e,r,n,t),getLastPoint:()=>eQ(e,r,n,t),get points(){return e2(e,t,r,n)}});function e9(e){if(eJ(e))return e9(e.__primaryKey);if(e instanceof eb||e instanceof eE)return e.toISOString();if(e?.type==="Attachment")return e.attachmentRid;if(Array.isArray(e))return e.map(e=>e9(e));if(e instanceof Set)return Array.from(e,e9);if(eN.isGeoShape(e)||e instanceof em)return e.toGeoJson();if(e&&e.definition)return e.definition;if("object"==typeof e)return Object.entries(e).reduce((e,[t,r])=>(e[t]=e9(r),e),{});return e}async function e4(e,t,r,a){return P(async()=>{let s=await (0,n.vZ)((0,o.Sy)(e.stack,e.fetch),e.ontology.metadata.ontologyApiName,t,{parameters:r?e5(r):{},options:a?a.mode===Z.VALIDATE_ONLY?{mode:"VALIDATE_ONLY"}:{mode:"VALIDATE_AND_EXECUTE",returnEdits:a.returnEdits===ee.ALL?"ALL":"NONE"}:{}});return er.of(e,s)},e=>y(new I,e,e.parameters))}async function e8(e,t,r,a){return P(async()=>{let s=await (0,n.Vt)((0,o.Sy)(e.stack,e.fetch),e.ontology.metadata.ontologyApiName,t,{requests:r?r.map(e=>({parameters:e5(e)})):[],options:a?{returnEdits:a.returnEdits===ee.ALL?"ALL":"NONE"}:{}});return en.of(e,s)},e=>y(new I,e,e.parameters))}function e5(e){return Object.entries(e).reduce((e,[t,r])=>(e[t]=e9(r),e),{})}async function e6(e,t,r,n,o=[],a){return P(async()=>e7(e,t,r,n,o,a),e=>(function(e,t,r){switch(t.errorName){case"ObjectTypeNotFound":return e.handleObjectTypeNotFound(t,r.objectType);case"ObjectTypeNotSynced":return e.handleObjectTypeNotSynced(t,r.objectType);case"ObjectsExceededLimit":return e.handleObjectsExceededLimit(t);case"OntologySyncing":return e.handleOntologySyncing(t,r.objectType);case"PropertiesNotFound":return e.handlePropertiesNotFound(t,r.objectType,r.properties);case"PropertiesNotSearchable":return e.handlePropertiesNotSearchable(t,r.properties);case"PropertyTypesSearchNotSupported":return e.handlePropertyTypesSearchNotSupported(t,r);case"PropertiesNotFilterable":return e.handlePropertiesNotFilterable(t,r.properties);case"MalformedPropertyFilters":return e.handleMalformedPropertyFilters(t,r.malformedPropertyFilter);case"InvalidRangeQuery":return e.handleInvalidRangeQuery(t,r.field,r.lt,r.gt,r.lte,r.gte);case"InvalidPropertyValue":return e.handleInvalidPropertyValue(t,r.propertyBaseType,r.property,r.propertyValue);case"PropertiesNotSortable":return e.handlePropertiesNotSortable(t,r.properties);case"InvalidSortOrder":return e.handleInvalidSortOrder(t,r.invalidSortOrder);case"QueryDepthExceededLimit":return e.handleQueryDepthExceededLimit(t,r.depth,r.depthLimit);case"InvalidPropertyFiltersCombination":return e.handleInvalidPropertyFiltersCombination(t,r.propertyFilters,r.property);case"DuplicateOrderBy":return e.handleDuplicateOrderBy(t,r.properties);case"InvalidSortType":return e.handleInvalidSortType(t,r.invalidSortType);case"PropertyFiltersNotSupported":return e.handlePropertyFiltersNotSupported(t,r.propertyFilters,r.property);case"InvalidPropertyFilterValue":return e.handleInvalidPropertyFilterValue(t,r.expectedType,r.propertyFilter,r.propertyFilterValue,r.property);case"PermissionDenied":return e.handlePermissionDenied(t);case"Unauthorized":return e.handleUnauthorized(t);case"UnknownError":return e.handleUnknownError(t);default:return t.errorName,e.handleUnknownError(t)}})(new E,e,e.parameters))}async function e7(e,t,r,a,s=[],i){let u=await (0,n.cC)((0,o.Sy)(e.stack,e.fetch),e.ontology.metadata.ontologyApiName,function(e,t,r=[],n){let o={objectSet:e,select:r.map(e=>e.toString())};return t&&t?.length>0&&(o={...o,orderBy:{fields:t}}),n&&n?.pageSize&&(o={...o,pageSize:n.pageSize}),n&&n?.pageToken&&(o={...o,pageToken:n.pageToken}),o}(r,a,s,i));return{data:u.data.map(t=>Y(e,t)),nextPageToken:u.nextPageToken}}async function*te(e,t,r,n,o=[]){let a;do{let s=await e6(e,t,r,n,o,{pageToken:a});if("ok"===s.type)for(let e of(a=s.value.nextPageToken,s.value.data))yield e}while(null!=a)}async function tt(e,t,r,n,o=[]){let a;let s=[];do{if("error"===(a=await e6(e,t,r,n,o,a?.type==="ok"&&void 0!==a.value.nextPageToken?{pageToken:a.value.nextPageToken}:void 0)).type)return a;for(let e of a.value.data)s.push(e)}while(void 0!==a.value.nextPageToken);return{type:"ok",value:s}}function tr(e,t,r,n,o=[]){return{all:()=>tt(e,t,r,o,n),page:a=>e6(e,t,r,o,n,a),asyncIter:()=>te(e,t,r,o,n),fetchPage:a=>e7(e,t,r,o,n,a),fetchPageWithErrors:a=>e6(e,t,r,o,n,a),get:r=>q(e,t,r,n),fetchOneWithErrors:r=>q(e,t,r,n),fetchOne:r=>X(e,t,r,n)}}var tn=function(e){return e.MILLISECONDS="MILLISECONDS",e.SECONDS="SECONDS",e.MINUTES="MINUTES",e.HOURS="HOURS",e.DAYS="DAYS",e.WEEKS="WEEKS",e.MONTHS="MONTHS",e.YEARS="YEARS",e.QUARTERS="QUARTERS",e}({});function to(e){if("Bucketing"!==e.type||!e.kind)throw Error("The provided bucketing is not supported.")}function ta(e,t){switch(e.kind){case"ExactValueBucketing":return t.onExactValue(e);case"RangeBucketing":return t.onRange(e);case"FixedWidthBucketing":return t.onFixedWidth(e);case"DurationBucketing":return t.onDuration(e);default:throw Error(`Unhandled bucketing: ${JSON.stringify(e)}`)}}function ts(e,t){let r={};return e&&(r.startValue=e),t&&(r.endValue=t),r}function ti(e){return e instanceof eE?e.toISOString():e instanceof eb?e.toISOString():e}var tu=function(e){return e.NUMERIC="NUMERIC",e.STRING="STRING",e.BOOLEAN="BOOLEAN",e.DATE="DATE",e.TIMESTAMP="TIMESTAMP",e}({}),tc=function(e){return e.NUMERIC="Numeric",e.TIMESTAMP="Timestamp",e.LOCALDATE="LocalDate",e}({});function td(e,t){switch(t){case tc.NUMERIC:return e;case tc.TIMESTAMP:return tp(e);case tc.LOCALDATE:return ty(e);default:throw Error(`Unknown metric value type encountered: ${t}`)}}function tl(e,t,r){let n=r[e];switch(n){case tu.NUMERIC:case tu.STRING:case tu.BOOLEAN:return t;case tu.DATE:return ty(t);case tu.TIMESTAMP:return tp(t);default:throw Error(`Unknown group value type encountered: ${n}`)}}function tp(e){return"number"==typeof e?eE.fromEpochMilli(e):eE.fromISOString(e)}function tm(e){if(e)return tp(e)}function ty(e){return"number"==typeof e?eE.fromEpochMilli(e).toLocalDate():eb.fromISOString(e)}function tg(e){if(e)return ty(e)}var th=class{#r;#n;#o;#a;constructor(e,t,r=[],n=[]){this.#r=e,this.#n=t,this.#a=r,this.#o=n}async compute(){var e,t;return await (e=this.#r,t={objectSet:this.#n,aggregation:this.#o,groupBy:this.#a},P(async()=>{let r=t.groupBy?t.groupBy.map(e=>ta(e,{onExactValue:e=>({type:"exact",field:e.propertyApiName,maxGroupCount:e.maxGroupCount}),onRange:e=>({type:"ranges",field:e.propertyApiName,ranges:e.ranges.map(e=>{let t,r;return(void 0!==e.startValue&&(t=ti(e.startValue)),void 0!==e.endValue&&(r=ti(e.endValue)),void 0===t)?{endValue:r}:void 0===r?{startValue:t}:{startValue:t,endValue:r}})}),onFixedWidth:e=>({type:"fixedWidth",field:e.propertyApiName,fixedWidth:e.fixedWidth}),onDuration:e=>({type:"duration",field:e.propertyApiName,value:e.value,unit:e.unit})})):[],a=t.aggregation.map(e=>"count"===e.type?{type:"count",name:e.name}:{type:e.type,name:e.name,field:e.field});return function(e,t){if(t.groupBy&&0===t.groupBy.length&&1===t.aggregation.length){let r=t.aggregation[0].metricValueType;return td(e.data[0]?.metrics[0]?.value,r)}let r=t.aggregation.reduce((e,t)=>(e[t.name]=t.metricValueType,e),{}),n=t.groupBy?.reduce((e,t)=>(e[t.propertyApiName]=t.keyDataType,e),{})??{},o=e.data.map(e=>{var o;let a=function(e,t){let r={};return e.forEach(e=>{let n=t[e.name];r[e.name]=td(e.value,n)}),r}(e.metrics,r);return{group:(o=t.groupBy,Object.entries(e.group).reduce((e,[t,r])=>(ta(o.find(e=>e.propertyApiName===t),{onExactValue(o){e[t]=tl(t,r,n)},onRange(o){let a=n[t];if(a===tu.DATE){let n=tg(r.startValue),o=tg(r.endValue);e[t]=ts(n,o)}else if(a===tu.TIMESTAMP){let n=tm(r.startValue),o=tm(r.endValue);e[t]=ts(n,o)}else{let n=r.startValue?Number(r.startValue):void 0,o=r.endValue?Number(r.endValue):void 0;e[t]=ts(n,o)}},onFixedWidth(o){e[t]=tl(t,r,n)},onDuration(o){e[t]=tl(t,r,n)}}),e),{})),...a}});return{excludedItems:e.excludedItems||0,groups:o}}(await (0,n.Zy)((0,o.Sy)(e.stack,e.fetch),e.ontology.metadata.ontologyApiName,{objectSet:t.objectSet,groupBy:r,aggregation:a}),t)},e=>(function(e,t,r){switch(t.errorName){case"PropertiesNotSearchable":return e.handlePropertiesNotSearchable(t,r.properties);case"PropertyTypesSearchNotSupported":return e.handlePropertyTypesSearchNotSupported(t,r);case"PropertiesNotFilterable":return e.handlePropertiesNotFilterable(t,r.properties);case"InvalidAggregationRangeValue":return e.handleInvalidAggregationRangeValue(t,r.property,r.objectType,r.propertyBaseType);case"OntologySyncing":return e.handleOntologySyncing(t,r.objectType);case"InvalidRangeQuery":return e.handleInvalidRangeQuery(t,r.field,r.lt,r.gt,r.lte,r.gte);case"InvalidPropertyValue":return e.handleInvalidPropertyValue(t,r.propertyBaseType,r.property,r.propertyValue);case"PropertiesNotSortable":return e.handlePropertiesNotSortable(t,r.properties);case"InvalidFields":return e.handleInvalidFields(t,r.field);case"AggregationGroupCountExceededLimit":return e.handleAggregationGroupCountExceededLimit(t,r.groupCount,r.groupCountLimit);case"InvalidSortOrder":return e.handleInvalidSortOrder(t,r.invalidSortOrder);case"QueryDepthExceededLimit":return e.handleQueryDepthExceededLimit(t,r.depth,r.depthLimit);case"InvalidPropertyFiltersCombination":return e.handleInvalidPropertyFiltersCombination(t,r.propertyFilters,r.property);case"DuplicateOrderBy":return e.handleDuplicateOrderBy(t,r.properties);case"InvalidAggregationRange":return e.handleInvalidAggregationRange(t);case"InvalidSortType":return e.handleInvalidSortType(t,r.invalidSortType);case"PropertyFiltersNotSupported":return e.handlePropertyFiltersNotSupported(t,r.propertyFilters,r.property);case"MultipleGroupByOnFieldNotSupported":return e.handleMultipleGroupByOnFieldNotSupported(t,r.field);case"InvalidPropertyFilterValue":return e.handleInvalidPropertyFilterValue(t,r.expectedType,r.propertyFilter,r.propertyFilterValue,r.property);case"InvalidAggregationRangePropertyType":return e.handleInvalidAggregationRangePropertyType(t,r.property,r.objectType,r.propertyBaseType);case"PermissionDenied":return e.handlePermissionDenied(t);case"Unauthorized":return e.handleUnauthorized(t);case"UnknownError":return e.handleUnknownError(t);default:return t.errorName,e.handleUnknownError(t)}})(new l,e,e.parameters)))}},tI={type:"CountOperation",operation:"count"};function tf(e){return"CountOperation"===e.type}var tT=e=>({exact:t=>({type:"Bucketing",kind:"ExactValueBucketing",propertyApiName:e,maxGroupCount:t,keyDataType:tu.BOOLEAN})}),tN=e=>({exact:t=>({type:"Bucketing",kind:"ExactValueBucketing",propertyApiName:e,keyDataType:tu.DATE,maxGroupCount:t}),byDays:t=>tS(e,tn.DAYS,t),byWeek:()=>tS(e,tn.WEEKS),byMonth:()=>tS(e,tn.MONTHS),byQuarter:()=>tS(e,tn.QUARTERS),byYear:()=>tS(e,tn.YEARS),ranges:t=>({type:"Bucketing",kind:"RangeBucketing",propertyApiName:e,keyDataType:tu.DATE,ranges:t})});function tS(e,t,r=1){return{type:"Bucketing",kind:"DurationBucketing",keyDataType:tu.DATE,propertyApiName:e,unit:t,value:r}}var tE=e=>({fixedWidth:t=>({type:"Bucketing",kind:"FixedWidthBucketing",keyDataType:tu.NUMERIC,propertyApiName:e,fixedWidth:t}),exact:t=>({type:"Bucketing",kind:"ExactValueBucketing",keyDataType:tu.NUMERIC,propertyApiName:e,maxGroupCount:t}),ranges:t=>({type:"Bucketing",kind:"RangeBucketing",keyDataType:tu.NUMERIC,propertyApiName:e,ranges:t})}),tb=e=>({exact:t=>({type:"Bucketing",kind:"ExactValueBucketing",keyDataType:tu.STRING,propertyApiName:e,maxGroupCount:t})}),tO=e=>({exact:t=>({type:"Bucketing",kind:"ExactValueBucketing",keyDataType:tu.TIMESTAMP,propertyApiName:e,maxGroupCount:t}),byMilliseconds:(t=1)=>tA(e,tn.MILLISECONDS,t),bySeconds:(t=1)=>tA(e,tn.SECONDS,t),byMinutes:(t=1)=>tA(e,tn.MINUTES,t),byHours:(t=1)=>tA(e,tn.HOURS,t),byDays:(t=1)=>tA(e,tn.DAYS,t),byWeek:()=>tA(e,tn.WEEKS),byMonth:()=>tA(e,tn.MONTHS),byQuarter:()=>tA(e,tn.QUARTERS),byYear:()=>tA(e,tn.YEARS),ranges:t=>({type:"Bucketing",kind:"RangeBucketing",keyDataType:tu.TIMESTAMP,propertyApiName:e,ranges:t})});function tA(e,t,r=1){return{type:"Bucketing",kind:"DurationBucketing",keyDataType:tu.TIMESTAMP,propertyApiName:e,unit:t,value:r}}var tw=e=>({type:"ApproximateDistinctCountAggregatableProperty",exactDistinct:()=>({type:"MultipleAggregationsOperations",operation:"exactDistinct",metricValueType:tc.NUMERIC,propertyApiName:e}),approximateDistinct:()=>({type:"MultipleAggregationsOperations",operation:"approximateDistinct",metricValueType:tc.NUMERIC,propertyApiName:e})}),tk=e=>({type:"AggregatableProperty",metricValueType:tc.NUMERIC,propertyApiName:e}),tC=(e,t)=>({type:"MultipleAggregationsProperty",max:()=>({type:"MultipleAggregationsOperations",operation:"max",metricValueType:t,propertyApiName:e}),min:()=>({type:"MultipleAggregationsOperations",operation:"min",metricValueType:t,propertyApiName:e}),sum:()=>({type:"MultipleAggregationsOperations",operation:"sum",metricValueType:t,propertyApiName:e}),avg:()=>({type:"MultipleAggregationsOperations",operation:"avg",metricValueType:t,propertyApiName:e}),approximateDistinct:()=>({type:"MultipleAggregationsOperations",operation:"approximateDistinct",metricValueType:t,propertyApiName:e}),exactDistinct:()=>({type:"MultipleAggregationsOperations",operation:"exactDistinct",metricValueType:t,propertyApiName:e})}),tP=e=>tC(e,tc.LOCALDATE),tD=e=>tC(e,tc.NUMERIC),tv=e=>tC(e,tc.TIMESTAMP),tF=O(function(e,t){return Object.entries(e.objects[t].properties).reduce((e,[t,r])=>(e[t]=tk(t),w(t)&&(e[`${t}_`]=e[t]),e),{})}),tL=O(function(e,t){return Object.entries(e.objects[t].properties).reduce((e,[t,r])=>{switch(r.type){case"boolean":e[t]=tT(t);break;case"datetime":e[t]=tN(t);break;case"timestamp":e[t]=tO(t);case"short":case"long":case"float":case"decimal":case"byte":case"double":case"integer":e[t]=tE(t);break;case"string":case"marking":e[t]=tb(t);break;case"geopoint":case"geoshape":case"attachment":case"numericTimeseries":case"stringTimeseries":return e;default:r.type}return w(t)&&(e[`${t}_`]=e[t]),e},{})}),tR=O(function(e,t){return Object.entries(e.objects[t].properties).reduce((e,[t,r])=>{switch(r.type){case"datetime":case"timestamp":e[t]=tP(t);break;case"byte":case"decimal":case"double":case"float":case"integer":case"long":case"boolean":case"short":e[t]=tD(t);break;case"attachment":case"geopoint":case"geoshape":case"string":case"marking":e[t]=tw(t);break;case"numericTimeseries":case"stringTimeseries":break;default:r.type}return w(t)&&(e[`${t}_`]=e[t]),e},{count:()=>tI})});function tj(e,t,r,n=[],o=[]){return{page:async a=>e6(e,t,r,o,n,a),fetchPage:async a=>e7(e,t,r,o,n,a),fetchPageWithErrors:async a=>e6(e,t,r,o,n,a),all:async()=>tt(e,t,r,o,n),asyncIter:()=>te(e,t,r,o)}}var tM=e=>({isNull:()=>({type:"isNull",field:e,value:!0}),contains:t=>({type:"contains",field:e,value:t})}),tU=e=>({isNull:()=>({type:"isNull",field:e,value:!0})}),tG=e=>({eq:t=>({type:"eq",field:e,value:t}),isNull:()=>({type:"isNull",field:e,value:!0})}),t_=e=>tx(e),tV=e=>tx(e),tx=e=>({eq:t=>({type:"eq",field:e,value:t.toISOString()}),lt:t=>({type:"lt",field:e,value:t.toISOString()}),gt:t=>({type:"gt",field:e,value:t.toISOString()}),lte:t=>({type:"lte",field:e,value:t.toISOString()}),gte:t=>({type:"gte",field:e,value:t.toISOString()}),isNull:()=>({type:"isNull",field:e,value:!0})}),tB=e=>({withinBoundingBox:t=>({type:"withinBoundingBox",field:e,value:{topLeft:t.topLeft.toGeoJson(),bottomRight:t.bottomRight.toGeoJson()}}),withinMillimetersOf:(t,r)=>tK(e,t,ed.ofMillimeters(r)),withinCentimetersOf:(t,r)=>tK(e,t,ed.ofCentimeters(r)),withinMetersOf:(t,r)=>tK(e,t,ed.ofMeters(r)),withinKilometersOf:(t,r)=>tK(e,t,ed.ofKilometers(r)),withinInchesOf:(t,r)=>tK(e,t,ed.ofInches(r)),withinFeetOf:(t,r)=>tK(e,t,ed.ofFeet(r)),withinYardsOf:(t,r)=>tK(e,t,ed.ofYards(r)),withinMilesOf:(t,r)=>tK(e,t,ed.ofMiles(r)),withinNauticalMilesOf:(t,r)=>tK(e,t,ed.ofNauticalMiles(r)),withinPolygon:t=>({type:"withinPolygon",field:e,value:t.toGeoJson()})});function tK(e,t,r){return{type:"withinDistanceOf",field:e,value:{center:t.toGeoJson(),distance:{value:r.value,unit:r.unit}}}}var tJ=e=>({withinBoundingBox:t=>({type:"withinBoundingBox",field:e,value:{topLeft:t.topLeft.toGeoJson(),bottomRight:t.bottomRight.toGeoJson()}}),intersectsBoundingBox:t=>({type:"intersectsBoundingBox",field:e,value:{topLeft:t.topLeft.toGeoJson(),bottomRight:t.bottomRight.toGeoJson()}}),doesNotIntersectBoundingBox:t=>({type:"doesNotIntersectBoundingBox",field:e,value:{topLeft:t.topLeft.toGeoJson(),bottomRight:t.bottomRight.toGeoJson()}}),withinPolygon:t=>({type:"withinPolygon",field:e,value:t.toGeoJson()}),intersectsPolygon:t=>({type:"intersectsPolygon",field:e,value:t.toGeoJson()}),doesNotIntersectPolygon:t=>({type:"doesNotIntersectPolygon",field:e,value:t.toGeoJson()})}),tW=e=>({eq:t=>({type:"eq",field:e,value:t}),lt:t=>({type:"lt",field:e,value:t}),gt:t=>({type:"gt",field:e,value:t}),lte:t=>({type:"lte",field:e,value:t}),gte:t=>({type:"gte",field:e,value:t}),isNull:()=>({type:"isNull",field:e,value:!0})}),t$={};((e,t)=>{for(var r in t)i(e,r,{get:t[r],enumerable:!0})})(t$,{and:()=>tz,not:()=>tY,or:()=>tQ});var tz=(...e)=>({type:"and",value:e}),tQ=(...e)=>({type:"or",value:e}),tY=e=>({type:"not",value:e}),tH=e=>({asc:()=>({field:e,direction:"asc"}),desc:()=>({field:e,direction:"desc"})}),tq=e=>({eq:t=>({type:"eq",field:e,value:t}),lt:t=>({type:"lt",field:e,value:t}),gt:t=>({type:"gt",field:e,value:t}),lte:t=>({type:"lte",field:e,value:t}),gte:t=>({type:"gte",field:e,value:t}),isNull:()=>({type:"isNull",field:e,value:!0}),startsWith:t=>({type:"startsWith",field:e,value:t}),containsAllTermsInOrder:t=>({type:"containsAllTermsInOrder",field:e,value:t}),containsAnyTerm:t=>({type:"containsAnyTerm",field:e,value:t}),containsAllTerms:t=>({type:"containsAllTerms",field:e,value:t})}),tX=O(function(e,t){return Object.entries(e.objects[t].properties).reduce((e,[t])=>(e[t]=tH(t),w(t)&&(e[`${t}_`]=e[t]),e),{})});function tZ(e,t){return Object.fromEntries(Object.entries(e.objects[t].properties).map(([e,t])=>[e,{apiName:e,description:t.description??""}]))}var t0=O(function(e,t){return Object.entries(e.objects[t].properties).reduce((e,[t,r])=>("numericTimeseries"===r.type||"stringTimeseries"===r.type||(e[t]=function(e,t){if(t.multiplicity)return tM(e);switch(t.type){case"string":case"marking":return tq(e);case"boolean":return tG(e);case"datetime":return tV(e);case"double":case"integer":case"short":case"long":case"float":case"decimal":case"byte":return tW(e);case"timestamp":return t_(e);case"attachment":return tU(e);case"geopoint":return tB(e);case"geoshape":return tJ(e);case"numericTimeseries":case"stringTimeseries":throw Error(`Invalid property for filtering ${t.type}`);default:throw t.type,Error(`Unknown property type ${t.type}`)}}(t,r),w(t)&&(e[`${t}_`]=e[t])),e),{})});function t1(e,t,r){return{definition:r,union:(...n)=>t1(e,t,{type:"union",objectSets:[r,...n.map(e=>e.definition)]}),intersect:(...n)=>t1(e,t,{type:"intersect",objectSets:[r,...n.map(e=>e.definition)]}),subtract:(...n)=>t1(e,t,{type:"subtract",objectSets:[r,...n.map(e=>e.definition)]}),where(n){let o=n(t0(e.ontology,t));return t1(e,t,{type:"filter",objectSet:r,where:o})},select:n=>tr(e,t,r,n),pivotTo(n){let o=e.ontology.objects[t];return t1(e,o.links[n].targetType,{type:"searchAround",objectSet:r,link:n})},...function(e,t,r){let n={};for(let[o,{targetType:a}]of Object.entries(e.ontology.objects[t].links))n[`searchAround${o.charAt(0).toUpperCase()+o.substring(1)}`]=()=>t1(e,a,{type:"searchAround",objectSet:r,link:o});return n}(e,t,r),...function e(t,r,n,o=[]){return{orderBy(a){let s=a(tX(t.ontology,r));return function(t,r,n,o=[]){return{...e(t,r,n,o),...tj(t,r,n,[],o),select:e=>tr(t,r,n,e,o)}}(t,r,n,[...o,s])}}}(e,t,r),...function e(t,r,n,o){let a=tF(t.ontology,r),s=tL(t.ontology,r),i=tR(t.ontology,r);return{aggregate(e){let r=e(i);return new th(t,n,o,Object.keys(r).map(e=>{let t=r[e];if(tf(t))return{type:t.operation,name:e,metricValueType:tc.NUMERIC,namedAggregation:!1};if("MultipleAggregationsOperations"===t.type)return{type:t.operation,name:e,field:t.propertyApiName,metricValueType:t.metricValueType,namedAggregation:!1};throw Error(`Unknown aggregation type: ${t.type}`)}))},approximateDistinct(e){let r=e(a);return new th(t,n,o,[{type:"approximateDistinct",name:"distinctCount",field:r.propertyApiName,metricValueType:r.metricValueType,namedAggregation:!0}])},exactDistinct(e){let r=e(a);return new th(t,n,o,[{type:"exactDistinct",name:"exactDistinctCount",field:r.propertyApiName,metricValueType:r.metricValueType,namedAggregation:!0}])},groupBy(a){let i=a(s);return to(i),e(t,r,n,[...o,i])},count:()=>new th(t,n,o,[{type:"count",name:"count",metricValueType:tc.NUMERIC,namedAggregation:!0}]),min(e){let r=e(a);return new th(t,n,o,[{type:"min",name:"min",field:r.propertyApiName,metricValueType:r.metricValueType,namedAggregation:!0}])},max(e){let r=e(a);return new th(t,n,o,[{type:"max",name:"max",field:r.propertyApiName,metricValueType:r.metricValueType,namedAggregation:!0}])},avg(e){let r=e(a);return new th(t,n,o,[{type:"avg",name:"avg",field:r.propertyApiName,metricValueType:r.metricValueType,namedAggregation:!0}])},sum(e){let r=e(a);return new th(t,n,o,[{type:"sum",name:"sum",field:r.propertyApiName,metricValueType:r.metricValueType,namedAggregation:!0}])}}}(e,t,r,[]),...tj(e,t,r)}}function t2(e,t,r){return P(async()=>{let a=await (0,n.Ih)((0,o.Sy)(e.stack,e.fetch),e.ontology.metadata.ontologyApiName,t,{parameters:r?Object.entries(r).reduce((e,[t,r])=>(e[t]=e9(r),e),{}):{}});return{value:await t3(e,e.ontology.queries[t].output,a.value)}},e=>(function(e,t,r){switch(t.errorName){case"ParameterObjectSetRidNotFound":return e.handleParameterObjectSetRidNotFound(t,r.parameterSetRid);case"PropertyBaseTypeNotSupported":return e.handlePropertyBaseTypeNotSupported(t,r.objectType,r.property,r.propertyBaseType);case"QueryTimeExceededLimit":return e.handleQueryTimeExceededLimit(t,r.functionRid,r.functionVersion);case"InvalidParameterValue":return e.handleInvalidParameterValue(t,r.parameterId);case"QueryNotFound":return e.handleQueryNotFound(t,r.queryId);case"ParameterObjectNotFound":return e.handleParameterObjectNotFound(t,r.objectType,r.primaryKey);case"QueryMemoryExceededLimit":return e.handleQueryMemoryExceededLimit(t,r.functionRid,r.functionVersion);case"QueryEncounteredUserFacingError":return e.handleQueryEncounteredUserFacingError(t,r.queryRid,r.queryVersion,r.message);case"ParameterTypeNotSupported":return e.handleParameterTypeNotSupported(t,r.parameterId,r.parameterBaseType);case"MissingParameter":return e.handleMissingParameter(t,r.parameters);case"PermissionDenied":return e.handlePermissionDenied(t);case"Unauthorized":return e.handleUnauthorized(t);case"UnknownError":return e.handleUnknownError(t);default:return t.errorName,e.handleUnknownError(t)}})(new f,e,e.parameters))}async function t3(e,t,r){if(null==r){if(t.nullable)return;throw Error("Got null response when nullable was not allowed")}if(t.multiplicity){let n={...t,multiplicity:!1};return await Promise.all(r.map(t=>t3(e,n,t)))}switch(t.type){case"attachment":throw Error("Attachment type not supported in response");case"date":return eb.fromISOString(r);case"timestamp":return eE.fromISOString(r);case"string":case"boolean":case"double":case"float":case"integer":case"long":return r;default:switch(t.type){case"object":if("object"!=typeof r){let n=await q(e,t.object,r,[]);if(B(n))return n.value;throw n.error}return Y(e,r);case"set":if(!Array.isArray(r))throw Error(`Expected response in array format, but received ${typeof r}`);return new Set(await Promise.all(r.map(async r=>t3(e,t.set,r))));case"struct":{if("object"!=typeof r)throw Error(`Expected object response, but received ${typeof r}`);let n=Object.entries(r);return(await Promise.all(n.map(async([r,n])=>{let o=t.struct[r];return[r,await t3(e,o,n)]}))).reduce((e,[t,r])=>(e[t]=r,e),{})}case"twoDimensionalAggregation":return{groups:r.groups.map(e=>({key:t9(t.twoDimensionalAggregation,e.key),value:t4(t.twoDimensionalAggregation.valueType,e.value)}))};case"threeDimensionalAggregation":return{groups:r.groups.map(e=>({key:t9(t.threeDimensionalAggregation,e.key),value:e.groups.map(e=>({key:t9(t.threeDimensionalAggregation.valueType,e.key),value:t4(t.threeDimensionalAggregation.valueType.valueType,e.value)}))}))};case"objectSet":return t1(e,t.objectSet,{type:"reference",reference:r});case"union":throw Error("Union type is not supported in response");default:throw Error(`Cannot remap query response of type ${JSON.stringify(t)}`)}}}function t9(e,t){if("string"==typeof e.keyType)switch(e.keyType){case"string":case"boolean":return t;case"range":return function(e,t){switch(e.keySubtype){case"date":return{startValue:t.startValue?eb.fromISOString(t.startValue):void 0,endValue:t.endValue?eb.fromISOString(t.endValue):void 0};case"timestamp":return{startValue:t.startValue?eE.fromISOString(t.startValue):void 0,endValue:t.endValue?eE.fromISOString(t.endValue):void 0};case"double":case"integer":return{startValue:t.startValue,endValue:t.endValue};default:throw e.keySubtype,Error(`Cannot remapRangeType with unsupported type ${e.keySubtype}`)}}(e,t)}throw Error(`Unsupported queryBucketKeyType ${JSON.stringify(e)} in remapQueryBucketKey`)}function t4(e,t){switch(e){case"date":return eb.fromISOString(t);case"double":return t;case"timestamp":return eE.fromISOString(t);default:throw Error(`Cannot remapQueryBucketValueType, ${e} is unsupported`)}}var t8=class{#r;constructor(e){this.#r=e}get objects(){return function(e){let t=new Proxy({},{get:(t,r,n)=>{if("string"==typeof r)return function(e,t){let r={type:"base",objectType:t};return{apiName:t,description:e.ontology.objects[t].description??"",properties:O(tZ)(e.ontology,t),get:r=>q(e,t,r),fetchOneWithErrors:r=>q(e,t,r),fetchOne:r=>X(e,t,r),select:n=>tr(e,t,r,n),...t1(e,t,r)}}(e,r)},ownKeys:t=>Object.keys(e.ontology.objects),getOwnPropertyDescriptor(r,n){if("string"==typeof n)return{enumerable:null!=e.ontology.objects[n],configurable:!0,value:t[n]}}});return t}(this.#r)}get actions(){return function(e){let t=new Proxy({},{get:(t,r,n)=>{if("string"==typeof r)return 0===Object.keys(e.ontology.actions[r].parameters).length?async function(t){return e4(e,r,void 0,t)}:async function(t,n){return e4(e,r,t,n)}},ownKeys:t=>Object.keys(e.ontology.actions),getOwnPropertyDescriptor(r,n){if("string"==typeof n)return{enumerable:null!=e.ontology.actions[n],configurable:!0,value:t[n]}}});return t}(this.#r)}get bulkActions(){return function(e){let t=new Proxy({},{get:(t,r,n)=>{if("string"==typeof r)return async function(t,n){return e8(e,r,t,n)}},ownKeys:t=>Object.keys(e.ontology.actions),getOwnPropertyDescriptor(r,n){if("string"==typeof n)return{enumerable:null!=e.ontology.actions[n],configurable:!0,value:t[n]}}});return t}(this.#r)}get batchActions(){return function(e){let t=new Proxy({},{get:(t,r,n)=>{if("string"==typeof r)return async function(t,n){return e8(e,r,t,n)}},ownKeys:t=>Object.keys(e.ontology.actions),getOwnPropertyDescriptor(r,n){if("string"==typeof n)return{enumerable:null!=e.ontology.actions[n],configurable:!0,value:t[n]}}});return t}(this.#r)}get queries(){return function(e){let t=new Proxy({},{get(t,r,n){let o=e.ontology.queries[r];if(o)return Object.keys(o.parameters).length>0?async function(t){return t2(e,r,t)}:async function(){return t2(e,r)}},ownKeys:t=>Object.keys(e.ontology.queries),getOwnPropertyDescriptor(r,n){if("string"==typeof n)return{enumerable:null!=e.ontology.queries[n],configurable:!0,value:t[n]}}});return t}(this.#r)}get attachments(){return eu(this.#r)}},t5=class{#r;constructor(e,t){this.foundryClientOptions=e,this.#r=(0,o.bR)(t,e.url,async()=>(await e.auth.getToken()).accessToken,"osdk-legacy-client/2.5.1",e.fetchFunction)}get ontology(){return new t8(this.#r)}get auth(){return this.foundryClientOptions.auth}},t6=class{constructor(e){this.options=e,e.fetchFn||(e.fetchFn=globalThis.fetch),e.scopes||(e.scopes=["api:read-data","api:write-data"])}async getToken(){return this.token||await this.signInAsServiceUser(),this.token?.isExpired&&await this.refresh(),{accessToken:this.token?.accessToken}}async executeWithToken(e){return e(await this.getToken())}async runWithToken(e){await e(await this.getToken())}async signInAsServiceUser(){let e=await ru(this.options.clientId,this.options.clientSecret,this.options.url,this.options.fetchFn,this.options.multipassContextPath,this.options.scopes);return this.token=e,this.startRefreshTimeout(e),{session:{accessToken:this.token.accessToken,expiresIn:this.token.expiresIn}}}async signOut(){return this.clearRefreshTimeout(),this.token&&await rc(this.token.accessToken,this.options.clientId,this.options.clientSecret,this.options.url,this.options.fetchFn,this.options.multipassContextPath),this.token=void 0,{}}async refresh(){this.token=await ru(this.options.clientId,this.options.clientSecret,this.options.url,this.options.fetchFn,this.options.multipassContextPath,this.options.scopes),this.startRefreshTimeout(this.token)}startRefreshTimeout(e){this.clearRefreshTimeout(),this.refreshTimeout=setTimeout(async()=>{this.refresh()},1e3*e.expiresIn-6e4)}clearRefreshTimeout(){this.refreshTimeout&&(clearTimeout(this.refreshTimeout),this.refreshTimeout=void 0)}};function t7(e,t){return e.cause=t,e}var re=class{constructor(e){this.checkTokenResponse(e),this.accessToken=e.access_token,this.tokenType=e.token_type,this.refreshToken=e.refresh_token,this.expiresAt=Date.now()+1e3*e.expires_in}get expiresIn(){return(this.expiresAt-Date.now())/1e3}get isExpired(){return Date.now()>=this.expiresAt}checkTokenResponse(e){if(null==e.access_token)throw Error("missing access_token");if(null==e.token_type)throw Error("missing token_type");if(null==e.expires_in)throw Error("missing expires_in")}};async function rt(e,t,r){let n=await e(t,{body:r.toString(),headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST",cache:"no-cache"});if(!n.ok)throw Error(`Response was not ok: ${n.status} ${n.statusText}`);return n}async function rr(e){let t=new TextEncoder().encode(e);return{codeChallenge:btoa(String.fromCharCode(...new Uint8Array(await crypto.subtle.digest("SHA-256",t)))).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,""),codeChallengeMethod:"S256"}}function rn(){return Array.from(crypto.getRandomValues(new Uint32Array(28)),e=>{let t="0"+e.toString(16);return t.substring(t.length-2)}).join("")}var ro="/multipass";function ra(e,t=ro){return ri(e,t,"/api/oauth2/token")}function rs(e,t=ro){return ri(e,t,"/api/oauth2/revoke_token")}function ri(e,t,r){return e=/^https?:\/\//i.test(e)?(0,o.Kz)(e):`https://${e}`,new URL(`${t.replace(/\/$/,"")}/${r.replace(/^\//,"")}`,e).toString()}async function ru(e,t,r,n=globalThis.fetch,o,a){let s=new URLSearchParams;s.append("grant_type","client_credentials"),s.append("client_id",e),s.append("client_secret",t),s.append("scopes",["offline_access",...a||[]].join(" "));let i=ra(r,o);try{let e=await rt(n,i,s),t=await e.json();return new re(t)}catch(e){throw t7(Error(`Failed to get token: ${e?e.toString():"Unknown error"}`),e)}}async function rc(e,t,r,n,o=globalThis.fetch,a){let s=new URLSearchParams;s.append("client_id",t),s.append("client_secret",r),s.append("token",e);let i=rs(n,a);try{await rt(o,i,s)}catch(e){throw t7(Error(`Failed to revoke token: ${e?e.toString():"Unknown error"}`),e)}}async function rd(e,t,r,n,o){let a=rn(),s=rn(),i=await rr(s),u=new URLSearchParams;return u.append("client_id",e),u.append("response_type","code"),u.append("state",a),u.append("redirect_uri",r),u.append("code_challenge",i.codeChallenge),u.append("code_challenge_method",i.codeChallengeMethod),u.append("scope",["offline_access",...o||[]].join(" ")),{url:function(e,t=ro){return ri(e,t,"/api/oauth2/authorize")}(t,n)+"?"+u.toString(),state:a,codeVerifier:s}}async function rl(e,t,r,n,o,a=globalThis.fetch,s){let i=new URLSearchParams(r.substring(r.indexOf("?"))),u=i.get("error");if(u)throw Error("Error received from server: "+u);let c=i.get("code");if(!c)throw Error("Code parameter missing in URL: "+r);let d=new URLSearchParams;d.append("client_id",e),d.append("grant_type","authorization_code"),d.append("code",c),d.append("redirect_uri",t),d.append("code_verifier",o);let l=ra(n,s);try{let e=await rt(a,`${l}?`+new URLSearchParams({state:o}),d),t=await e.json();return new re(t)}catch(e){throw t7(Error(`Failed to get token: ${e?e.toString():"Unknown error"}`),e)}}async function rp(e,t,r,n=globalThis.fetch,o){let a=new URLSearchParams;a.append("client_id",t),a.append("grant_type","refresh_token"),a.append("refresh_token",e);let s=ra(r,o);try{let e=await rt(n,s,a),t=await e.json();return new re(t)}catch(e){throw t7(Error(`Failed to refresh token: ${e?e.toString():"Unknown error"}`),e)}}async function rm(e,t,r,n=globalThis.fetch,o){let a=new URLSearchParams;a.append("client_id",t),a.append("token",e);let s=rs(r,o);try{await rt(n,s,a)}catch(e){throw t7(Error(`Failed to revoke token: ${e?e.toString():"Unknown error"}`),e)}}var ry=class{palantirRefreshToken="palantir_refresh_token";palantirPkce="palantir_pkce";nextSubscriberId=0;onSignInSubscribers={};onSignOutSubscribers={};onRefreshTokenSubscribers={};token=null;refreshTimeout=null;constructor(e){this.options=e,e.fetchFn||(e.fetchFn=globalThis.fetch),e.scopes||(e.scopes=["api:read-data","api:write-data"])}async getToken(){if(!this.token)throw Error("Not signed in");return{accessToken:this.token.accessToken}}async executeWithToken(e){return e({accessToken:(await this.getToken()).accessToken})}async runWithToken(e){let t=await this.getToken();await e({accessToken:t.accessToken})}async signIn(){let e=!0,t=localStorage.getItem(this.palantirRefreshToken);t&&await this.tryRefreshToken(t)&&(e=!1);let r=sessionStorage.getItem(this.palantirPkce);if(r&&e)try{let t=window.location.href;this.token=await rl(this.options.clientId,this.options.redirectUrl,t,this.options.url,r,this.options.fetchFn,this.options.multipassContextPath),null!=this.token.refreshToken&&localStorage.setItem(this.palantirRefreshToken,this.token.refreshToken),e=!1}catch(e){throw console.warn("Failed to get OAuth2 token using PKCE, removing PKCE",e),sessionStorage.removeItem(this.palantirPkce),e}if(e){let e=await rd(this.options.clientId,this.options.url,this.options.redirectUrl,this.options.multipassContextPath,this.options.scopes);sessionStorage.setItem(this.palantirPkce,e.codeVerifier),window.location.href=e.url,await new Promise((e,t)=>{setTimeout(()=>{t(Error("Unable to redirect to authorization page"))},1e3)})}if(!this.token)throw Error("Error signing in");for(let e of(this.startRefreshTimeout(this.token),Object.values(this.onSignInSubscribers)))e();return{session:{accessToken:this.token.accessToken,expiresIn:this.token.expiresIn}}}async signOut(){if(!this.token)throw Error("Not signed in");for(let e of(await rm(this.token.accessToken,this.options.clientId,this.options.url,this.options.fetchFn,this.options.multipassContextPath),Object.values(this.onSignOutSubscribers)))e();return this.clearRefreshTimeout(),sessionStorage.removeItem(this.palantirPkce),localStorage.removeItem(this.palantirRefreshToken),this.token=null,{}}async refresh(){let e=localStorage.getItem(this.palantirRefreshToken);if(!e)throw Error("No refresh token found");if(!await this.tryRefreshToken(e))throw Error("Could not refresh token");if(!this.token)throw Error("Expected token to be present");for(let e of(this.startRefreshTimeout(this.token),Object.values(this.onRefreshTokenSubscribers)))e();return{session:{accessToken:this.token.accessToken,expiresIn:this.token.expiresIn}}}subscribe(e){let t=this.nextSubscriberId++;return e.onSignIn&&(this.onSignInSubscribers[t]=e.onSignIn),e.onSignOut&&(this.onSignOutSubscribers[t]=e.onSignOut),e.onRefreshToken&&(this.onRefreshTokenSubscribers[t]=e.onRefreshToken),()=>{delete this.onSignInSubscribers[t],delete this.onSignOutSubscribers[t],delete this.onRefreshTokenSubscribers[t]}}startRefreshTimeout(e){this.clearRefreshTimeout(),this.refreshTimeout=setTimeout(async()=>{await this.refresh()},1e3*e.expiresIn-6e4)}clearRefreshTimeout(){this.refreshTimeout&&(clearTimeout(this.refreshTimeout),this.refreshTimeout=null)}async tryRefreshToken(e){try{return this.token=await rp(e,this.options.clientId,this.options.url,this.options.fetchFn,this.options.multipassContextPath),null!=this.token.refreshToken&&localStorage.setItem(this.palantirRefreshToken,this.token.refreshToken),!0}catch(e){return console.warn("Failed to get OAuth2 refresh token. Removing refresh token",e),localStorage.removeItem(this.palantirRefreshToken),!1}}},rg=class{constructor(e){this.options=e}async getToken(){return{accessToken:"function"==typeof this.options.userToken?await this.options.userToken():this.options.userToken}}async executeWithToken(e){return e(await this.getToken())}async runWithToken(e){await e(await this.getToken())}}}}]);